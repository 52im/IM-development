# 8 长短链接在IM中的使用
IM软件中，常常使用长连接和短连接来处理很多业务。那么什么时候应该使用长连接，什么时候应该使用短连接呢？

一般情况下，使用短连接的地方都可以用长连接代替，但这样不利于解耦，而且对IM服务器的压力比较大，因此有必要合理使用长连接和短连接。

对于长连接使用场景，主要是消息透传和短时间内高频、较小数据量的数据交互以及推送。这样选择的原因有如下几点：

1.  服务器不知道客户端IP地址，如果是服务器发送给客户端的话，就需要保持一个长连接。
2.  建立一个短连接需要TCP 三次握手，在移动端TCP三次握手的时间也是挺可观的。
3.  维持一个长连接本身需要以小于NAT超时的间隔定时发送心跳包，需要耗费流量和电量。

其他场景则可以使用短连接。

一般现在移动客户端长短连接配合如下：
1.  短连接用途1：前置HTTP的SSO单点接口来实现身份认证；
2.  短连接用途2：集群式的IM中可能还会有独立（或集成于SSO单独登陆接口中）的SLB接口（即基于HTTP短连接拉取IM服务器集群IP列表）；
3.  短连接用途3：各种小文件的上传、下载接口实现（头像、图片、语音、文件等）都会是基于Http实现；
4.  短连接用途4：离线消息的批量拉取；
5.  短连接用户5：拉取好友详情、群组详情、群友详情等。
6.  长连接用途1：用户的实时上、下线状态通知；
7.  长连接用途2：实时的加友、加群等指令收发；
8.  长连接用途3：服务端发起的其它实时指令推送等。
