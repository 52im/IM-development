# 3 如何处理消息的顺序
IM软件因为消息上下文的原因，因此需要保证消息的顺序。但是网络传输本身是无序的（即TCP/IP协议并不保证数据包接收的顺序），因此需要IM软件自己维护消息的顺序。通常的做法是在最终的接收端依据消息ID或者时间戳来做排序的。
一般有两种做法来维护消息的顺序：
1.  消息ID本身由发送方标识和发送方维护的递增数据来标识，直接用消息ID进行排序。
2.  每个消息都带有一个时间戳，接收方在收到消息时候，根据时间戳进行排序。
然而上述两种做法都存在不同的问题，使用第一种方案，利用发送方递增标识，对于单对单聊天没有问题，但无法保证群聊中消息的顺序。使用第二种方案的话，时间戳是按照发送方的时间戳还是IM服务器的时间戳，如果发送方（client A）的本地时间不准又该如何处理呢？
因为现在IM服务器一般都是使用集群的，每台机器的时钟并不能保证是一致的。因此要保证消息的顺序，对于单对单聊天可以采用第一种方案由发送方维护一个递增的顺序ID来标识，对于群聊则由系统生成一个递增的顺序ID，每次发送消息的时候带上顺序ID来保证消息的顺序。




